<h1>Newsletter</h1>

<!-- Send Email Button -->
<div class="email-actions" *ngIf="getSelectedAccountsCount() > 0">
  <button class="send-email-btn" (click)="openEmailComposer()">
    Send Email to Selected Accounts ({{ getSelectedAccountsCount() }})
  </button>
</div>

<table>
  <tr>
    <th>
      <input
        type="checkbox"
        [checked]="selectAll"
        (change)="onSelectAll($event)"
        title="Select All"
      />
    </th>

    <th></th>
    <th>First Name</th>
    <th>Last Name</th>
    <th>Email</th>
  </tr>
  <tr *ngFor="let account of accounts; let i = index">
    <td class="checkbox">
      <input
        type="checkbox"
        [checked]="isAccountSelected(account)"
        (change)="onAccountSelect(account, $event)"
      />
    </td>
    <td class="count">{{ i + 1 }}</td>

    <td>
      {{ account.fName }}
    </td>
    <td>
      {{ account.lName }}
    </td>
    <td>
      {{ account.email }}
    </td>
  </tr>
</table>

<!-- Email Composer Modal -->
<div
  class="email-modal-overlay"
  *ngIf="showEmailComposer"
  (click)="closeEmailComposer()"
>
  <div class="email-modal" (click)="$event.stopPropagation()">
    <div class="email-modal-header">
      <h2>Send Email to {{ getSelectedAccountsCount() }} Account(s)</h2>
      <button class="close-btn" (click)="closeEmailComposer()">&times;</button>
    </div>

    <form [formGroup]="emailForm" class="email-form">
      <div class="form-group">
        <label for="subject">Subject *</label>
        <input
          type="text"
          id="subject"
          formControlName="subject"
          placeholder="Enter email subject"
          class="subject-input"
        />
      </div>

      <div class="form-group">
        <label for="body">Message *</label>
        <div class="editor-container">
          <quill-editor
            formControlName="body"
            [modules]="quillConfig"
            placeholder="Compose your email message..."
            class="email-editor"
            (onEditorCreated)="onEditorCreated($event)"
          >
          </quill-editor>
          <div *ngIf="isUploading" class="upload-indicator">
            Uploading image...
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="closeEmailComposer()">
          Cancel
        </button>
        <button
          type="button"
          class="send-btn"
          (click)="sendEmail()"
          [disabled]="emailForm.invalid || isUploading"
        >
          Send Email
        </button>
      </div>
    </form>
  </div>
</div>
